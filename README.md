# PDF QA System

PDF 문서를 처리하고 자연어 질문에 답변하는 시스템입니다.

## 기능

- PDF 파일에서 텍스트 추출 및 전처리
- **OCR 지원**: 스캔된 PDF 및 이미지 기반 PDF 처리 가능
- **고속 OCR**: 속도와 정확도 최적화된 OCR 처리
- **실시간 진행상황 추적**: PDF 처리 과정을 실시간으로 확인
- **스마트 진행상황 메시지**: 80% 이상 진행 시 "거의 다 됐습니다!" 메시지 표시
- 500 토큰 단위로 텍스트 청킹
- 벡터 임베딩 생성 및 Pinecone 벡터 DB 저장
- 자연어 질문에 대한 유사도 기반 검색
- Gemini LLM을 통한 답변 생성
- JSON 형태의 구조화된 출력

## 최신 개선사항 (v2.0)

### 🚀 OCR 속도 및 정확도 최적화
- **단일 OCR 설정 사용**: 여러 설정 시도 대신 한글 이름 인식에 최적화된 설정 사용
- **이미지 전처리 최적화**: 해상도 제한(1500-3000px)으로 처리 속도 향상
- **텍스트 정리 최적화**: 핵심적인 한글 이름 수정 패턴만 유지하여 이름 정보 손상 방지
- **PDF 변환 최적화**: 해상도를 2x로 제한하여 속도와 품질의 균형점 찾기

### 📊 실시간 진행상황 추적 시스템
- **백엔드 진행상황 추적**: PDF 처리 단계별 진행상황 실시간 업데이트
- **프론트엔드 실시간 표시**: 1초마다 진행상황 조회하여 사용자에게 표시
- **진행률 바**: 시각적 진행률 표시
- **페이지별 진행상황**: 총 페이지 수와 현재 처리 중인 페이지 표시

### 🎯 스마트 진행상황 메시지
- **80% 이상**: "거의 다 됐습니다! 🎉"
- **60% 이상**: "분석이 진행 중입니다..."
- **30% 이상**: "OCR 처리가 진행 중입니다..."
- **기본**: "PDF 파일을 분석하고 있습니다..."

### 🔧 처리 단계별 상세 진행상황
1. **파일 검증** (0-10%): 파일 형식 및 크기 검증
2. **파일 저장** (10-20%): 임시 파일 생성
3. **PDF 분석** (20-30%): PDF 페이지 수 확인
4. **텍스트 추출** (30-50%): OCR 또는 일반 텍스트 추출
5. **텍스트 청킹** (50-60%): 텍스트를 청크 단위로 분할
6. **벡터 데이터 정리** (60-70%): 기존 벡터 데이터 삭제
7. **벡터 저장** (70-90%): 청크별 벡터 데이터베이스 저장
8. **완료** (90-100%): 처리 완료

## 설치

### 1. Python 패키지 설치
```bash
pip install -r requirements.txt
```

### 2. Tesseract OCR 설치 (OCR 기능 사용 시)

#### Windows
1. [Tesseract 설치 파일](https://github.com/UB-Mannheim/tesseract/wiki) 다운로드
2. 설치 시 "Additional language data"에서 Korean 언어팩 선택
3. 기본 설치 경로: `C:\Program Files\Tesseract-OCR\`

#### macOS
```bash
brew install tesseract
brew install tesseract-lang  # 언어팩 설치
```

#### Ubuntu/Debian
```bash
sudo apt update
sudo apt install tesseract-ocr
sudo apt install tesseract-ocr-kor  # 한국어 언어팩
```

### 3. 환경 변수 설정
```bash
cp env_example.txt .env
```
`.env` 파일을 편집하여 API 키들을 설정하세요.

## 사용법

### 1. 환경 설정

먼저 `.env` 파일을 생성하고 API 키들을 설정하세요:

```bash
cp env_example.txt .env
```

`.env` 파일을 편집하여 실제 API 키들을 입력하세요:

```
GEMINI_API_KEY=your_actual_gemini_api_key_here
PINECONE_API_KEY=your_actual_pinecone_api_key_here
PINECONE_ENVIRONMENT=your_actual_pinecone_environment_here
```

### 2. 간단한 사용 예시

```bash
python example_usage.py
```

### 3. API 서버 실행

```bash
python api.py
```

### 4. 웹 인터페이스 사용

#### 프론트엔드 실행
```bash
cd frontend
npm install
npm start
```

브라우저에서 `http://localhost:3000`으로 접속하여 웹 인터페이스를 사용할 수 있습니다.

#### 전체 시스템 실행 (Windows)
```bash
start_full_system.bat
```

### 5. API 엔드포인트

#### 1. PDF 업로드 및 처리
```
POST /upload-pdf
```
PDF 파일을 업로드하여 벡터 DB에 저장합니다.
- 일반 PDF: 텍스트 직접 추출
- 스캔된 PDF: OCR을 통한 텍스트 추출

#### 2. 진행상황 조회
```
GET /processing-status
```
현재 PDF 처리 진행상황을 반환합니다.

응답 예시:
```json
{
  "is_processing": true,
  "progress": 75,
  "current_step": "벡터 데이터베이스에 저장 중...",
  "current_page": 3,
  "total_pages": 5
}
```

#### 3. 질문하기
```
POST /ask-question
```
JSON 형태로 질문을 전송하여 답변을 받습니다.

예시:
```json
{
  "question": "PDF에서 어떤 내용이 설명되어 있나요?"
}
```

응답:
```json
{
  "answer": "생성된 답변",
  "source": [
    {
      "chunk_id": "chunk_1",
      "snippet": "관련 텍스트 스니펫"
    }
  ]
}
```

## OCR 기능

이 시스템은 OCR(Optical Character Recognition) 기능을 지원하여 다음과 같은 PDF를 처리할 수 있습니다:

- **스캔된 PDF**: 종이 문서를 스캔한 PDF
- **이미지 기반 PDF**: 텍스트가 이미지로 저장된 PDF
- **혼합 PDF**: 텍스트와 이미지가 섞인 PDF

### OCR 처리 과정
1. 일반 텍스트 추출 시도
2. 텍스트가 부족한 경우 OCR 자동 활성화
3. PDF를 이미지로 변환
4. **이미지 전처리** (해상도 향상, 노이즈 제거, 대비 조정)
5. Tesseract OCR로 텍스트 추출
6. **텍스트 정리** (OCR 오류 수정, 특수문자 정리)
7. 한국어 및 영어 동시 지원

### OCR 성능 최적화 (v2.0)

#### 1. 속도 최적화
- **단일 OCR 설정**: `--oem 3 --psm 6 -l kor+eng` (한글 이름 인식에 최적화)
- **이미지 해상도 제한**: 1500-3000px 범위로 제한하여 처리 속도 향상
- **간소화된 전처리**: 불필요한 모폴로지 연산 제거
- **PDF 변환 최적화**: 2x 해상도로 제한하여 속도와 품질 균형

#### 2. 정확도 향상
- **한글 이름 특화**: 한글 이름 인식에 최적화된 텍스트 정리
- **핵심 패턴 유지**: 과도한 정리 작업 제거로 이름 정보 손상 방지
- **품질 기반 선택**: 원본 이미지와 전처리 이미지 중 더 나은 결과 선택

#### 3. 진행상황 추적
- **실시간 업데이트**: 1초마다 진행상황 조회
- **단계별 표시**: 파일 검증 → 저장 → 분석 → 추출 → 청킹 → 저장 → 완료
- **페이지별 진행**: 총 페이지 수와 현재 처리 중인 페이지 표시

### OCR 정확도 향상 프로세스

#### 1. 이미지 전처리 최적화
- **해상도 제한**: 1500-3000px 범위로 최적화
- **노이즈 제거**: 중간값 필터(3x3)로 노이즈 제거
- **적응형 이진화**: 가우시안 적응형 임계값 처리
- **대비 향상**: 1.3x 대비로 텍스트 선명화

#### 2. OCR 설정 최적화
- **PSM 모드**: 6 (단일 블록 - 한글 이름에 적합)
- **OEM 모드**: 3 (기본 OCR 엔진 - 속도와 정확도 균형)
- **언어 설정**: 한국어 + 영어 동시 지원
- **품질 평가**: 텍스트 품질 기반으로 원본/전처리 이미지 선택

#### 3. 텍스트 정리 최적화
- **한글 이름 특화**: 성씨 + 이름 패턴에서 공백 제거
- **생년월일 패턴**: 이름 + 생년월일 형식 정리
- **핵심 오류 수정**: 이름, 생년, 월일, 연락, 이메일 등 기본적인 한글 단어 수정
- **과도한 정리 제거**: 이름 정보 손상 방지를 위한 최소한의 정리만 수행

## 프로젝트 구조

### 백엔드 (Python)
- `pdf_processor.py`: PDF 텍스트 추출 및 청킹 (OCR 지원, 속도 최적화)
- `vector_store.py`: Pinecone 벡터 DB 관리
- `llm_service.py`: Gemini LLM 서비스
- `pdf_qa_system.py`: 전체 시스템 통합 (진행상황 추적 지원)
- `api.py`: FastAPI REST API (진행상황 추적 엔드포인트 포함)
- `example_usage.py`: 간단한 사용 예시
- `test_system.py`: 시스템 테스트
- `debug_pdf.py`: PDF 처리 디버깅 도구
- `requirements.txt`: 필요한 패키지 목록
- `env_example.txt`: 환경 변수 예시

### 프론트엔드 (React + TypeScript)
- `frontend/`: React 웹 애플리케이션
  - `src/components/`: React 컴포넌트들 (진행상황 표시 포함)
  - `src/services/`: API 서비스 (진행상황 조회 포함)
  - `src/types/`: TypeScript 타입 정의
  - `package.json`: Node.js 의존성

## 환경 변수

- `GEMINI_API_KEY`: Google AI (Gemini) API 키
- `PINECONE_API_KEY`: Pinecone API 키
- `PINECONE_ENVIRONMENT`: Pinecone 환경
- `PINECONE_INDEX_NAME`: Pinecone 인덱스 이름

## 성능 개선 효과 (v2.0)

### 속도 개선
- **OCR 처리 속도**: 기존 대비 3-5배 빠른 처리 속도
- **이미지 전처리**: 불필요한 연산 제거로 2-3배 속도 향상
- **텍스트 정리**: 핵심 패턴만 유지하여 정리 속도 향상

### 정확도 유지
- **한글 이름 인식**: 한글 이름 인식 정확도 유지
- **OCR 품질**: 품질 기반 선택으로 최적 결과 보장
- **안정성**: 더 안정적인 OCR 결과

### 사용자 경험 개선
- **실시간 피드백**: 진행상황을 실시간으로 확인 가능
- **스마트 메시지**: 80% 이상 진행 시 "거의 다 됐습니다!" 메시지
- **페이지별 진행**: 구체적인 처리 상태 파악 가능

## 문제 해결

### OCR 관련 오류
- **"Tesseract가 설치되어 있는지 확인해주세요"**: Tesseract OCR이 설치되지 않았습니다.
- **"OCR 처리 중 오류가 발생했습니다"**: Tesseract 경로 설정이나 언어팩 문제일 수 있습니다.

### PDF 처리 오류
- **"텍스트를 추출할 수 없습니다"**: PDF가 손상되었거나 이미지 품질이 낮을 수 있습니다.
- **타임아웃 오류**: 대용량 PDF 처리 시 시간이 오래 걸릴 수 있습니다.

### 진행상황 추적 오류
- **진행상황이 업데이트되지 않음**: 백엔드 서버가 실행 중인지 확인하세요.
- **Bad Request 오류**: PDF 파일 형식이나 크기를 확인하세요.

### OCR 정확도 개선 팁
- **이미지 품질**: 원본 PDF의 해상도가 높을수록 좋습니다
- **텍스트 대비**: 검은 텍스트와 흰 배경이 가장 인식률이 높습니다
- **폰트 크기**: 10pt 이상의 폰트가 인식률이 높습니다
- **회전**: 텍스트가 수평으로 정렬된 것이 좋습니다

## 업데이트 히스토리

### v2.0 (최신)
- 🚀 OCR 속도 및 정확도 최적화
- 📊 실시간 진행상황 추적 시스템 추가
- 🎯 80% 이상 진행 시 "거의 다 됐습니다!" 메시지
- 🔧 처리 단계별 상세 진행상황 표시
- ⚡ 성능 개선: 3-5배 빠른 OCR 처리 속도

### v1.0
- 기본 PDF QA 시스템 구현
- OCR 기능 추가
- 웹 인터페이스 구현 